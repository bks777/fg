var audiosprite = require('audiosprite');
var fs = require('fs'),
    util = require('util');

var fileName = process.argv[2];
var filePath = process.argv[3];
var currentPath = process.argv[4];
var files = process.argv.slice(5);

var opts = {output: fileName, channels: 2};

audiosprite(files, opts, function(err, obj) {
    if (err) return console.error(err)

    var fileConfig = filePath + "/" + fileName + ".json";
    fs.writeFile(fileConfig, JSON.stringify(obj, null, 2), function(err) {
        if(err) {
            return console.log(err);
        }

        console.log("The file "+ fileConfig +" was updated!");
    });

    obj.resources.forEach((a,b)=>{

        var oldPath = currentPath + "/" + a;
        var newPath = filePath + "/" + a;

        fs.readFile(oldPath , function(err, data) {
            fs.writeFile(newPath, data, function(err) {
                fs.unlink(oldPath, function(){
                    if(err) throw err;
                });
            });
        });
    });

    //console.log(JSON.stringify(obj, null, 2))
});