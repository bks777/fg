<!DOCTYPE html>
<html>
<head lang="en">
    <title>{{s buffer::GAME_SETTING.title s}}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <!--meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" /-->

    <style>
        canvas {
            margin: auto;
            display: block;
        }
    </style>

    {{ css_links }}

{{ js_libs }}

</head>
<body>

<canvas id="wrapper">canvas is not supported</canvas>

    {% tpl %}

    <script type="text/javascript">

        /*
         Game parameters
         */
        var $_args = {
            "game_path": "../{{s buffer::GAME_SETTING.alias s}}/",
            "variablePageSettings": "$_args",
            "token": "{{s buffer::GAME_SETTING.token s}}",
            "exit_url": "{{s buffer::GAME_SETTING.exit_url s}}",
            "endpoint": "{{s buffer::GAME_SETTING.endpoint s}}",
            "lang": "{{s buffer::GAME_SETTING.lang s}}",
            "alias": "{{s buffer::GAME_SETTING.alias s}}",
            "build_ts": +new Date(),
            "wl": "wl",
            "env": "dist",
            "fail_timeout": 3,
            "max_fails": 3,
            "max_timeout": "{{s buffer::GAME_SETTING.max_timeout s}}",
            "sound": true
        };

        window.location.search.substr(1).split('&').map(function(item){
            var r = item.split("=");
            $_args[r[0]] = r[1];
        });

        var style = document.createElement('link');
        style.setAttribute('rel', 'stylesheet');
        style.setAttribute('href', './game.css?build_ts=' + $_args.build_ts);
        document.head.appendChild(style);

        var script = document.createElement('script');
        script.setAttribute('type', 'text/javascript');
        script.setAttribute('src', './game.js?build_ts=' + $_args.build_ts);
        document.body.appendChild(script);
    </script>

    {% else %}

    <script>

        /*
         Game parameters
         */
        var $_args = {
            "game_path": "/../",
            "variablePageSettings": "$_args",
            "token": "{{s buffer::GAME_SETTING.token s}}",
            "exit_url": "{{s buffer::GAME_SETTING.exit_url s}}",
            "endpoint": "{{s buffer::GAME_SETTING.endpoint s}}",
            "lang": "{{s buffer::GAME_SETTING.lang s}}",
            "alias": "{{s buffer::GAME_SETTING.alias s}}",
            "build_ts": +new Date(),
            "wl": "wl",
            "env": "app",
            "fail_timeout": 3,
            "max_timeout": "{{s buffer::GAME_SETTING.max_timeout s}}",
            "max_fails": 3,
            "sound": true
        };

        window.location.search.substr(1).split('&').map(function(item){
            var r = item.split("=");
            $_args[r[0]] = r[1];
        });
    </script>

    {% end %}

{{ js_links }}

</body>
</html>
